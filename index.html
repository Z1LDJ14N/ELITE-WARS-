<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ELITE WARS v3 - Mobile Edition</title>
    <style>
        :root { --neon: #00ff41; --danger: #ff3131; }
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-touch-callout: none; }
        body { background: #050505; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        canvas { display: block; }

        /* UI HUD */
        #hud { position: absolute; top: 15px; left: 15px; color: var(--neon); z-index: 5; pointer-events: none; }
        .stat { font-size: 14px; font-weight: bold; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 4px; margin-bottom: 5px; border-left: 3px solid var(--neon); }

        /* VIRTUAL CONTROLS (Hanya Muncul di Touch Device / Selalu Aktif) */
        .controller { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 30px; z-index: 10; }
        .dpad, .action-btns { display: grid; grid-template-columns: repeat(3, 60px); grid-template-rows: repeat(2, 60px); gap: 10px; }
        .btn { 
            width: 60px; height: 60px; background: rgba(255,255,255,0.1); 
            border: 2px solid var(--neon); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            color: var(--neon); font-weight: bold; font-size: 12px;
            touch-action: manipulation;
        }
        .btn:active { background: var(--neon); color: #000; }
        .btn-fire { grid-column: 2 / 4; grid-row: 1 / 3; width: 100px; height: 100px; border-color: var(--danger); color: var(--danger); font-size: 20px; border-radius: 50%; }

        /* Menus */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 20; }
        button#startBtn { padding: 15px 40px; font-size: 20px; background: transparent; border: 2px solid var(--neon); color: var(--neon); cursor: pointer; border-radius: 50px; }
    </style>
</head>
<body>

    <div id="hud">
        <div class="stat">UNIT: ELITE-01</div>
        <div class="stat">HP: <span id="hp">100</span>%</div>
        <div class="stat">SCORE: <span id="score">0</span></div>
    </div>

    <div class="controller">
        <div class="dpad">
            <div style="grid-column: 2" class="btn" id="btnUp">W</div>
            <div style="grid-column: 1; grid-row: 2" class="btn" id="btnLeft">A</div>
            <div style="grid-column: 2; grid-row: 2" class="btn" id="btnDown">S</div>
            <div style="grid-column: 3; grid-row: 2" class="btn" id="btnRight">D</div>
        </div>
        <div class="action-btns">
            <div class="btn btn-fire" id="btnFire">FIRE</div>
        </div>
    </div>

    <div id="startScreen" class="screen">
        <h1 style="color: var(--neon); margin-bottom: 20px;">ELITE WARS</h1>
        <button id="startBtn">START MISSION</button>
    </div>

    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let gameActive = false;
    let score = 0;
    
    // Audio Engine
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playShootSound() {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        const filter = audioCtx.createBiquadFilter();

        osc.type = 'triangle';
        filter.type = 'lowpass';
        filter.frequency.setValueAtTime(1000, audioCtx.currentTime);

        osc.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);

        osc.frequency.setValueAtTime(400, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.1);
        
        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    class Player {
        constructor() {
            this.x = canvas.width / 2;
            this.y = canvas.height / 2;
            this.radius = 20;
            this.speed = 5;
            this.hp = 100;
            this.color = '#00ff41';
            this.dirX = 0;
            this.dirY = 0;
            this.angle = 0;
        }
        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);
            
            // Body Karakter Kece
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.moveTo(25, 0);
            ctx.lineTo(-15, -15);
            ctx.lineTo(-15, 15);
            ctx.closePath();
            ctx.fill();
            
            // Cannon
            ctx.fillStyle = "#fff";
            ctx.fillRect(0, -3, 20, 6);
            ctx.restore();
        }
        update() {
            this.x += this.dirX * this.speed;
            this.y += this.dirY * this.speed;
            
            // Boundary
            this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
            this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));
            this.draw();
        }
    }

    class Bullet {
        constructor(x, y, angle) {
            this.x = x; this.y = y;
            this.speed = 10;
            this.vx = Math.cos(angle) * this.speed;
            this.vy = Math.sin(angle) * this.speed;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(this.x, this.y, 4, 0, Math.PI*2);
            ctx.fill();
        }
    }

    class Enemy {
        constructor() {
            this.radius = 15;
            // Spawn di luar layar
            if (Math.random() < 0.5) {
                this.x = Math.random() < 0.5 ? 0 : canvas.width;
                this.y = Math.random() * canvas.height;
            } else {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() < 0.5 ? 0 : canvas.height;
            }
            this.speed = 2 + Math.random() * 2;
        }
        update(player) {
            const angle = Math.atan2(player.y - this.y, player.x - this.x);
            this.x += Math.cos(angle) * this.speed;
            this.y += Math.sin(angle) * this.speed;
            
            ctx.fillStyle = '#ff3131';
            ctx.shadowBlur = 10; ctx.shadowColor = 'red';
            ctx.fillRect(this.x - 10, this.y - 10, 20, 20);
            ctx.shadowBlur = 0;
        }
    }

    const player = new Player();
    let bullets = [];
    let enemies = [];

    // Controller Logic
    const keys = {};
    const setupControl = (id, dx, dy) => {
        const btn = document.getElementById(id);
        const start = (e) => { e.preventDefault(); if(dx!==null) player.dirX = dx; if(dy!==null) player.dirY = dy; };
        const end = (e) => { e.preventDefault(); if(dx!==null) player.dirX = 0; if(dy!==null) player.dirY = 0; };
        btn.addEventListener('touchstart', start);
        btn.addEventListener('touchend', end);
        btn.addEventListener('mousedown', start);
        btn.addEventListener('mouseup', end);
    };

    setupControl('btnUp', null, -1);
    setupControl('btnDown', null, 1);
    setupControl('btnLeft', -1, null);
    setupControl('btnRight', 1, null);

    const fireAction = () => {
        if(!gameActive) return;
        bullets.push(new Bullet(player.x, player.y, player.angle));
        playShootSound();
    };
    document.getElementById('btnFire').addEventListener('touchstart', (e) => { e.preventDefault(); fireAction(); });
    document.getElementById('btnFire').addEventListener('mousedown', fireAction);

    // Keyboard support
    window.addEventListener('keydown', e => {
        if(e.key === 'w') player.dirY = -1;
        if(e.key === 's') player.dirY = 1;
        if(e.key === 'a') player.dirX = -1;
        if(e.key === 'd') player.dirX = 1;
        if(e.key === ' ') fireAction();
    });
    window.addEventListener('keyup', e => {
        if(e.key === 'w' || e.key === 's') player.dirY = 0;
        if(e.key === 'a' || e.key === 'd') player.dirX = 0;
    });

    // Aiming (Mouse/Touch)
    window.addEventListener('mousemove', e => {
        player.angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
    });

    function spawnEnemy() {
        if(gameActive) {
            enemies.push(new Enemy());
            setTimeout(spawnEnemy, 1000);
        }
    }

    function loop() {
        if(!gameActive) return;
        ctx.fillStyle = 'rgba(5,5,5,0.2)';
        ctx.fillRect(0,0,canvas.width, canvas.height);

        player.update();

        bullets.forEach((b, i) => {
            b.update();
            if(b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) bullets.splice(i, 1);
        });

        enemies.forEach((en, ei) => {
            en.update(player);
            
            // Cek Tabrakan Player
            const d = Math.hypot(player.x - en.x, player.y - en.y);
            if(d < 25) {
                player.hp -= 1;
                document.getElementById('hp').innerText = Math.floor(player.hp);
                if(player.hp <= 0) location.reload();
            }

            // Cek Peluru
            bullets.forEach((b, bi) => {
                const bd = Math.hypot(b.x - en.x, b.y - en.y);
                if(bd < 20) {
                    enemies.splice(ei, 1);
                    bullets.splice(bi, 1);
                    score += 10;
                    document.getElementById('score').innerText = score;
                }
            });
        });

        requestAnimationFrame(loop);
    }

    document.getElementById('startBtn').addEventListener('click', () => {
        document.getElementById('startScreen').style.display = 'none';
        gameActive = true;
        if (audioCtx.state === 'suspended') audioCtx.resume();
        spawnEnemy();
        loop();
    });
</script>
</body>
</html>
